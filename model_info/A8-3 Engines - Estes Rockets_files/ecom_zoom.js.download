(function(name,context,definition){if(typeof define==='function'&&define.amd){define(definition);}
else if(typeof module!=='undefined'&&module.exports){module.exports=definition();}
else{context[name]=definition();}})('EcomImgZoom',this,function(){var dw,dh,rw,rh,lx,ly;var bind=function(target,events,callback){events=events.split(' ');for(var i=0,len=events.length;i<len;i++){if(target.attachEvent){target.attachEvent('on'+events[i],callback);}
else{target.addEventListener(events[i],callback,false);}}};var unbind=function(target,events,callback){events=events.split(' ');for(var i=0,len=events.length;i<len;i++){if(target.detachEvent){target.detachEvent('on'+events[i],callback);}
else{target.removeEventListener(events[i],callback,false);}}};var preventDefault=function(event){if(event.preventDefault){event.preventDefault();}
else{event.returnValue=false;}};var EcomImgZoom=function(element,options={}){this.target=element;this.layout=element.dataset.ecomZoomLayout||'inner';this.images=element.querySelectorAll('[data-ecom-role=zoom-target]');this.zoomWidth=options.width?options.width:'500px';this.zoomHeight=options.height?options.height:'500px';if(this.isOpen===undefined){this._init();}};EcomImgZoom.prototype._init=function(){var self=this;this._cache={};this.link={};this.image={};this.flyout=document.createElement('div');this.layout=='outer'?this.flyout.className='ecom-image-zoom-flyout ecom-image-zoom-window':this.flyout.className='ecom-image-zoom-flyout';this.notice=document.createElement('div');this.notice.className='ecom-image-zoom-notice';this._events={open:function(e){if(!self.isOpen){preventDefault(e);self._show(this,e);}},move:function(e){if(self.isOpen){preventDefault(e);self._move(e);}},hide:function(e){if(self.isOpen){preventDefault(e);self.hide();}}};for(var i=0,len=this.images.length;i<len;i++){bind(this.images[i],'mouseover',this._events.open);}
bind(this.target,'mousemove touchmove',this._events.move);bind(this.target,'touchend touchcancel',this._events.hide);bind(this.flyout,'mouseout',this._events.hide);if(this.layout=='outer'){bind(this.target,'mouseout',this._events.hide);}};EcomImgZoom.prototype._show=function(link,e){var w1,h1,w2,h2;var self=this;if(link.href!==this.link.href){this.link=link;this.image=link.querySelector('img');this._swap(link.href,function(){self._show(link,e);});return;}
if(this.layout=='outer'){this._outerLayout(e);setTimeout(function(){self.flyout.classList.add('ecom-open');},100);}else{this.target.appendChild(this.flyout);}
this.offset=this._getOffset(this.target);w1=this.image.clientWidth;h1=this.image.clientHeight;w2=this.flyout.clientWidth;h2=this.flyout.clientHeight;dw=this.zoom.clientWidth-w2;dh=this.zoom.clientHeight-h2;rw=dw/w1;rh=dh/h1;this.isOpen=true;this._move(e);};EcomImgZoom.prototype._getOffset=function(element){var parent=element.offsetParent;var offset={top:element.offsetTop,left:element.offsetLeft};if(parent.classList.contains('ecom-product-single__media--images-layout__slider')){offset.left=0;}
while(parent.nodeName.toLocaleLowerCase()!=='body'){offset.top+=parent.offsetTop;offset.left+=parent.offsetLeft;parent=parent.offsetParent;}
return offset;};EcomImgZoom.prototype._zIndex=function(index){const row=this.target.closest('.ecom-row.ecom-core'),block=this.target.closest('.ecom-block.ecom-core'),column=this.target.closest('.ecom-column.ecom-core');row?row.style.zIndex=index:'';block?block.style.zIndex=index:'';column?column.style.zIndex=index:'';}
EcomImgZoom.prototype._outerLayout=function(e){const rect=this.target.getBoundingClientRect(),offset=this._getOffset(this.target),offsetTop=offset.top,w_width=window.innerWidth;var top=rect.y>=0?offsetTop:offsetTop+Math.abs(rect.top)+50,left;if(w_width/2>rect.x){left=rect.x+rect.width+10;this.flyout.style.left=left+'px';}else{left=rect.x-parseInt(this.zoomWidth)-10;this.flyout.style.left=left+'px';}
this.flyout.style.position='absolute';this.flyout.style.top=top+'px';this.flyout.style.width=this.zoomWidth;this.flyout.style.height=this.zoomHeight;document.body.appendChild(this.flyout);}
EcomImgZoom.prototype._swap=function(href,callback){var self=this;if(this.zoom){this.flyout.removeChild(this.zoom);}
var swap=function(){self.zoom=self.flyout.appendChild(self._cache[href]);callback();};if(this._cache[href]){swap();}
else{this._load(href,swap);}};EcomImgZoom.prototype._load=function(href,callback){var self=this;var zoom=new Image();this.notice=this.target.appendChild(this.notice);this.target.className+=' is-loading';zoom.onerror=function(){self.link={};self.image={};self.notice.innerHTML='Error';self.target.className=self.target.className.replace(/is-loading/g,'is-error');setTimeout(function(){self.notice=self.target.removeChild(self.notice);self.target.className=self.target.className.replace(/is-error/g,'');},5000);};zoom.onload=function(){self._cache[href]=zoom;self.notice=self.target.removeChild(self.notice);self.target.className=self.target.className.replace(/is-loading/g,'is-ready');callback();};zoom.style.position='absolute';zoom.src=href;};EcomImgZoom.prototype._move=function(e){if(e.type.indexOf('touch')===0){lx=e.touches[0].pageX;ly=e.touches[0].pageY;}
else{lx=e.pageX||(e.clientX+document.body.scrollTop)||lx;ly=e.pageY||(e.clientY+document.body.scrollLeft)||ly;}
var pt=ly-this.offset.top;var pl=lx-this.offset.left;var xt=pt*rh;var xl=pl*rw;if(xl<0||xt<0||xl>dw||xt>dh){this.hide();}
else{this.zoom.style.top=''+(Math.ceil(xt)*-1)+'px';this.zoom.style.left=''+(Math.ceil(xl)*-1)+'px';}};EcomImgZoom.prototype.hide=function(){if(this.isOpen){if(this.layout=='outer'){this.flyout=document.body.removeChild(this.flyout);}else{this.flyout=this.target.removeChild(this.flyout);}
this.isOpen=false;unbind(this.target,'click',this._events.hide);}};EcomImgZoom.prototype.teardown=function(){if(this.isOpen){this.hide();}
for(var i=0,len=this.images.length;i<len;i++){unbind(this.images[i],'click',this._events.open);}
unbind(this.target,'mousemove touchmove',this._events.move);unbind(this.target,'touchend touchcancel',this._events.hide);delete this.zoom;delete this.link;delete this.image;delete this.notice;delete this.flyout;delete this.isOpen;};return EcomImgZoom;});